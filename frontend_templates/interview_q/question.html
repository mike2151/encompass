{% extends "base.html" %}
{% load static %}
{% load compress %}
{% load index %}
{% block css_imports %}
<link href="{% static 'interview/creation/main.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container" style="padding-top: 70px; max-width: 90vw;">
        <div class="row">
            <div class="col-sm-12">
                    <div class="py-5 text-center">
                        <img class="d-block mx-auto mb-4" src="{% static 'images/icon.png' %}" alt="" width="72" height="72">
                        <h2 class="page-title">Edit Interview Question: {{ question.name }}</h2>
                        <p class="page-description">
                            <b>How it works:</b><br /> During the process of creating a question, you will upload various files. When a user submits their code,
                            the user's code, your support (code base) files and test files will all be moved in the same directory and the test files
                            will be ran. You should keep this in mind when writing your code. 
                            The user will be brought to the results screen with a display of the visible tests they passed. After the user submits, you
                            will be able to see the user's test results and code submission. 
                        </p>
                    </div>
            </div>
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div id="form_errors">
                        {% if error_message %}
                            {{ error_message }}
                        {% endif %}
                    </div>
                    <!-- step -->
                    <hr />
                    <div class="row">
                        <div class="col-md-12">
                                <h2 class="step-title">Step 1: Basic Information About Your Question:</h2><br />
                        </div>
                        <div class="col-md-6">
                            <div class="form-group, step">
                                <label htmlFor="name">Name of Question (Visible to users)</label>
                                <input class="form-control" id="name" maxlength="128" name="name" type="text" value="{{ question.name }}"/><br />
    
                                <label htmlFor="description">Description of Question (Visible to users)</label>
                                <textarea class="form-control" id="description" name="description" rows=5>{{ question.description }}</textarea><br/>
    
                                <label for="question_language">Question Language (Visible to users) </label>
                                <select class="form-control" id="question_language" name="question_language">
                                    <option {% if question.language == 'Python3' %}selected{% endif %}>Python3</option>
                                </select> <br/>

                                <div class="form-check">
                                    <input class="form-check-input checkbox-style" type="checkbox" id="network_enabled" name="network_enabled" {% if question.network_enabled %}checked{% endif %}>
                                    <label class="form-check-label checkbox-label" for="network_enabled">
                                            Enable Network For This Question? <br /> We normally disable network access to best protect your supporting code.                               </label>
                                </div><br />
                            </div>
                        </div>
                        <div class="col-md-6">
                            <p class="step-description">In this step, provide a name for your question. 
                                    Additionally, provide the description of what the user has to do .
                                    This description will show up to the user. Markdown is supported.
                            </p>
                        </div>
                    </div>
                    <!-- end step -->
                    <!-- step -->
                    <hr />
                    <div class="row">
                        <div class="col-md-12">
                                <h2 class="step-title">Step 2: Write Your Supporting Code</h2><br />
                        </div>
                        <div class="col-md-6">
                            <div class="form-group, step">
                            <label class="centered code-label">Supporting Code (Not visible to users)</label> <br />
                            <div id="supporting_fields">
                                {% for support_code_name in supporting_code_names %}
                                    <div id="div_supporting_code_{{ forloop.counter }}">
                                        <div class="centered">Code<label class="switch"><input type="checkbox" name="supporting_switch_{{ forloop.counter }}" id="supporting_switch_{{ forloop.counter }}" disabled><span class="slider round"></span></label> File</div>
                                        <div class="centered"><input class="inputfile" type="file" id="supporting_file_{{ forloop.counter }}" name="supporting_file_{{ forloop.counter }}"></div>
                                        <div><input class="form-control name-of-file" id="supporting_body_name_{{ forloop.counter }}" maxlength="128" name="supporting_body_name_{{ forloop.counter }}" placeholder="Name of file" value="{{ support_code_name }}"></input></div>
                                        <div id="supporting_body_{{ forloop.counter }}" class="code-editor">{{ supporting_code_contents|index:forloop.counter0 }}</div>
                                        <textarea name="supporting_body_{{ forloop.counter }}"></textarea>
                                    </div>
                                {% endfor %}
                            </div>
                            <hr>
                            <button type="button" class="btn btn-light" onclick="add_code_file('supporting')">Add</button>
                            <button type="button" class="btn btn-light" onclick="remove_code_file('supporting')">Remove</button>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <p class="step-description">In this step, write the code that will run under the hood.
                                    This may be a class for instance.
                            </p>
                        </div>
                    </div>
                    <!-- end step -->
                    <!-- step -->
                    <hr />
                    <div class="row">
                        <div class="col-md-12">
                                <h2 class="step-title">Step 3: Define Your API</h2><br />
                        </div>
                        <div class="col-md-6">
                            <div class="form-group, step">
                                <label htmlFor="api_description">Description of API (Visible to users)</label> <br />
                                <textarea class="form-control" id="api_description" name="api_description" rows=5>{{ api_description }}</textarea><br/>
            
                                <center><label>Methods Shown To The User (Visible to users)</label><hr /></center>
                                <div id="api_fields">
                                    {% for api_method in api_methods %}
                                    <div>
                                        <label htmlFor="api_method_{{ forloop.counter }}">Method:</label><br/>
                                        <textarea class="form-control" id="api_method_{{ forloop.counter }}" name="api_method_{{ forloop.counter }}" >{{ api_method }}</textarea><br />
                                    </div>
                                    {% endfor %}
                                </div>
                                <button type="button" class="btn btn-light" onclick="add_api_field()">Add</button>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <p class="step-description">In this step, you will declare what methods are available to the user via the API.
                                 For example, you might declare that the return_value function is available to them. Markdown is supported.
                            </p>
                        </div>
                    </div>
                    <!-- end step -->
                    <!-- step -->
                    <hr />
                    <div class="row">
                        <div class="col-md-12">
                                <h2 class="step-title">Step 4: Provide Starter Code</h2><br />
                        </div>
                        <div class="col-md-6">
                            <div class="form-group, step">
                                <label class="centered code-label">Starter Code (visible to users)</label> <br />
                                <div id="starter_fields">
                                    {% for starter_code_name in starter_code_names %}
                                        <div id="div_starter_code_{{ forloop.counter }}">
                                            <div class="centered">Code<label class="switch"><input type="checkbox" name="starter_switch_{{ forloop.counter }}" id="starter_switch_{{ forloop.counter }}"><span class="slider round"></span></label> File</div>
                                            <div class="centered"><input class="inputfile" type="file" id="starter_file_{{ forloop.counter }}" name="starter_file_{{ forloop.counter }}"></div>
                                            <div><input class="form-control name-of-file" id="starter_body_name_{{ forloop.counter }}" maxlength="128" name="starter_body_name_{{ forloop.counter }}" placeholder="Name of file" value="{{ starter_code_name }}"></input></div>
                                            <div id="starter_body_{{ forloop.counter }}" class="code-editor">{{ starter_code_contents|index:forloop.counter0 }}</div>
                                            <textarea name="starter_body_{{ forloop.counter }}"></textarea>
                                        </div>
                                    {% endfor %}
                                </div>
                                <hr/>
                                <button type="button" class="btn btn-light" onclick="add_code_file('starter')">Add</button>
                                <button type="button" class="btn btn-light" onclick="remove_code_file('starter')">Remove</button>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <p class="step-description">In this step, you will detail the files that the user has to submit. For every file that has to be submitted, 
                                    a starter code file should be declared. You can just type the name of the file in the name of file field. You can optionally fill in some parts of the file 
                                    to get the user started. We automatically import 
                                    all of the supporting code files for each starter file. For example, if one of your support files was called, support.py, then import support would be automatically
                                    added to each starter file. Telling the user what files and methods they have access to should be done in the API section.
                            </p>
                        </div>
                    </div>
                    <!-- end step -->
                    <!-- step -->
                    <hr />
                    <div class="row">
                        <div class="col-md-12">
                                <h2 class="step-title">Step 5: Provide Useful Example Code</h2><br />
                        </div>
                        <div class="col-md-6">
                            <div class="form-group, step">
                                <label class="centered code-label">Example Code (visible to users)</label> <br />
                                <div id="example_fields">
                                    {% for example_code_name in example_code_names %}
                                        <div id="div_example_code_{{ forloop.counter }}">
                                            <div class="centered">Code<label class="switch"><input type="checkbox" name="example_switch_{{ forloop.counter }}" id="example_switch_{{ forloop.counter }}"><span class="slider round"></span></label> File</div>
                                            <div class="centered"><input class="inputfile" type="file" id="example_file_{{ forloop.counter }}" name="example_file_{{ forloop.counter }}"></div>
                                            <div><input class="form-control name-of-file" id="example_body_name_{{ forloop.counter }}" maxlength="128" name="example_body_name_{{ forloop.counter }}" placeholder="Name of file" value="{{ example_code_name }}"></input></div>
                                            <div id="example_body_{{ forloop.counter }}" class="code-editor">{{ example_code_contents|index:forloop.counter0 }}</div>
                                            <textarea name="example_body_{{ forloop.counter }}"></textarea>
                                        </div>
                                    {% endfor %}
                                </div>
                                <hr/>
                                <button type="button" class="btn btn-light" onclick="add_code_file('example')">Add</button>
                                <button type="button" class="btn btn-light" onclick="remove_code_file('example')">Remove</button>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <p class="step-description">In this step, you provide example code snippets and files.
                            </p>
                        </div>
                    </div>
                    <!-- end step -->
                    <!-- step -->
                    <hr />
                    <div class="row">
                        <div class="col-md-12">
                                <h2 class="step-title">Step 6: Provide Test Cases</h2><br />
                        </div>
                        <div class="col-md-6">
                            <div class="form-group, step">
                                <label class="centered code-label">Test Case Code (Not visible to users)</label> <br />
                                <div class="centered">Code<label class="switch"><input type="checkbox" name="test_switch_1" id="test_switch_1"><span class="slider round"></span></label> File</div>
                                <div class="centered"><input class="inputfile" type="file" id="test_file_1" name="test_file_1"></div>
                                <div><input class="form-control name-of-file" id="test_body_name_1" maxlength="128" name="test_body_name_1" placeholder="Name of file" value="{{ test_case_name }}"></input></div>
                                <div id="test_body_1" class="code-editor">{{ test_case_code_contents }}</div>
                                <textarea name="test_body_1"></textarea>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <p class="step-description">In this step, you provide test cases. An example is below:
                                <div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;" id="test_case_example">
                                    <pre style="margin: 0; line-height: 125%"><span style="color: #008000"># this unittest import is needed</span>
<span style="color: #0000ff">import</span> unittest

<span style="color: #0000ff">import</span> user_submitted_file
<span style="color: #008000"># indicate the visibility of your test 
to the user with a @visible @not_visible annotation</span>

<span style="color: #008000"># all test cases should be written in this class</span>
<span style="color: #0000ff">class</span> <span style="color: #2b91af">TestCases</span>(unittest.TestCase):
    @visible
    <span style="color: #0000ff">def</span> test_user_submitted_file(self):
        <span style="color: #0000ff">assert</span> user_submitted_file.custom_function() == 5

    @not_visible
    <span style="color: #0000ff">def</span> test_user_submitted_file_two(self):
        <span style="color: #0000ff">assert</span> user_submitted_file.custom_function() != 5
</pre></div>
                            </p>
                        </div>
                    </div>
                    <!-- end step -->
                    <!-- step -->
                    <hr />
                    <div class="row">
                        <div class="col-md-12">
                                <h2 class="step-title">Step 7: Provide A Solution</h2><br />
                        </div>
                        <div class="col-md-6">
                            <div class="form-group, step">
                                <label class="centered code-label">Optional Solution Code (Not visible to users)</label> <br />
                                <div id="solution_fields">
                                    {% for solution_code_name in solution_code_names %}
                                        <div id="div_solutiion_code_{{ forloop.counter }}">
                                            <div class="centered">Code<label class="switch"><input type="checkbox" name="solution_switch_{{ forloop.counter }}" id="solution_switch_{{ forloop.counter }}"><span class="slider round"></span></label> File</div>
                                            <div class="centered"><input class="inputfile" type="file" id="solution_file_{{ forloop.counter }}" name="solution_file_{{ forloop.counter }}"></div>
                                            <div><input class="form-control name-of-file" id="solution_body_name_{{ forloop.counter }}" maxlength="128" name="solution_body_name_{{ forloop.counter }}" placeholder="Name of file" value="{{ solution_code_name }}"></input></div>
                                            <div id="solution_body_{{ forloop.counter }}" class="code-editor">{{ solution_code_contents|index:forloop.counter0 }}</div>
                                            <textarea name="solution_body_{{ forloop.counter }}"></textarea>
                                        </div>
                                    {% endfor %}
                                </div>
                                <hr/>
                                <button type="button" class="btn btn-light" onclick="add_code_file('solution')">Add</button>
                                <button type="button" class="btn btn-light" onclick="remove_code_file('solution')">Remove</button>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <p class="step-description">In this step, you should provide a solution to ensure the code compiles. If you do not provide this, then the only way to validate behavior is to try out the question.
                            </p>
                        </div>
                    </div>
                    <!-- end step -->
                    <br /><br />
                    <center><button class="btn btn-success create-button" type="submit">Edit Interview Question</button></center>
                </form>
            </div>
    </div>
    <script src="https://pagecdn.io/lib/ace/1.4.5/ace.js" integrity="sha256-5Xkhn3k/1rbXB+Q/DX/2RuAtaB4dRRyQvMs83prFjpM=" crossorigin="anonymous"></script>    
    <script>
	function textarea_edit(name){var editor=ace.edit(name);editor.setTheme("ace/theme/chrome");editor.session.setMode("ace/mode/python");var textarea=$('textarea[name="'+name+'"]').hide();textarea.val(editor.getSession().getValue());editor.getSession().on('change',function(){textarea.val(editor.getSession().getValue())})}
function switch_code(number,name){$("#"+name+"_file_"+number).hide();$("#"+name+"_switch_"+number).change(function(){if(this.checked){$("#"+name+"_body_name_"+number).hide();$("#"+name+"_body_"+number).hide();$("#"+name+"_file_"+number).show()}else{$("#"+name+"_body_"+number).show();$("#"+name+"_body_name_"+number).show();$("#"+name+"_file_"+number).hide()}})}
function populate_array(array,string_name){for(var i=1;i<array.length+1;i++){textarea_edit(string_name+"_body_"+i.toString());switch_code(i.toString(),string_name)}}
var code_names={{supporting_code_names|safe}};populate_array(code_names,"supporting");code_names={{starter_code_names|safe}};populate_array(code_names,"starter");code_names={{example_code_names|safe}};populate_array(code_names,"example");code_names={{solution_code_names|safe}};populate_array(code_names,"solution");textarea_edit("test_body_1");switch_code("1","test");
$(document).on("keydown", ":input:not(textarea)", function(event) {return event.key != "Enter";});
    </script>
        
    {% compress js %}
    <script src="{% static 'main/js/create.js' %}"></script>
    {% endcompress %}

{% endblock %}
