{% extends "base.html" %}
{% load static %}
{% block css_imports %}
<link href="{% static 'main/css/answer.css' %}" rel="stylesheet"  type="text/css">
{% endblock %}


{% block content %}
  <div class="main_container" >
      <div class="row">
        <div class="col-lg-3 mb-3 sidebar">
            <center><h2 class="sidebar-title">QUESTION OVERVIEW</h2></center><hr />
            <center><h2>Question Description</h2></center>
            <p class="question-description">{{ question.base_question.description }}</p>
            <center><h2>API DOCUMENTATION</h2></center>
            <ul class="api-list">
            {% for api_method in api_methods %}
              <li class="api-list-item">{{ api_method.api_signature }}</li>
            {% endfor %}
            </ul>
            
            <center><h2>EXAMPLE CODE</h2></center>
            <ul class="example-code-list">
                {% for example_code in example_code_snippets %}
                  <li><div id="example_code_{{ forloop.counter }}" class="example_code_view" style="height: 70vh; width: 100%">{{ example_code.body }}</div></li>
                {% endfor %}
                </ul>
        </div>
          <div class="col-lg-9 mb-9 answer-section">
              <form method="post">
              {% csrf_token %}
              <div class="col-lg-9 mb-9" style="background-color: #DCDCDC; max-width: 100%; margin-top: 1vh;">
                <div style="float: right">
                    <select id="file-drop-down" onchange="onSelectFileChange()">
                      {% for filename in files_to_work_on_names %}
                        <option value="{{ filename }}">{{ filename }}</option>
                      {% endfor %}
                    </select>
                    <button type="button" class="btn btn-info">Question</button>
                    <button type="button" class="btn btn-info">API</button>
                    <button type="button" class="btn btn-info">Example Code</button>
                    <button type="submit" name="action" value="submit_code" class="btn btn-success">Submit Code</button>
                </div>
              </div>
              <br />
              <div class="col-lg-9 mb-9 editor-holder">
                <div id="editor" style="height: 60vh; width: 100%">{{question.base_question.starter_code}}</div>
                <textarea name="editor"></textarea>
              </div>
              <div class="col-lg-9 mb-9 test-case-section">
                  <hr />
                  <h3 class="test-case-header">Write Test Cases</h3>
                  <div id="test_case_editor" style="height: 20vh; width: 100%"></div>
                  <textarea name="test_case_editor"></textarea>
                  <center><button type="button" class="btn btn-info test-case-button">Run Test Case</button></center>
              </div>
              <div id="file_contents" type="hidden">

              </div>
              </form>
          </div>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://pagecdn.io/lib/ace/1.4.5/ace.js" integrity="sha256-5Xkhn3k/1rbXB+Q/DX/2RuAtaB4dRRyQvMs83prFjpM=" crossorigin="anonymous"></script>    
    <script type='text/javascript'>      
      // init select
      var starter_code_bodies = {{files_to_work_on_bodies|safe}}; 
      var file_name_to_body = {};
      var currently_selected_file = $("#file-drop-down option:selected").text();
      function initSetUpStarterFiles() {
        var i = 0;
        $("#file-drop-down > option").each(function() {
          file_name_to_body[this.text] = starter_code_bodies[i];
          var input = document.createElement("input");
          input.setAttribute("type", "hidden");
          input.setAttribute("name", "file_" + this.text);
          input.setAttribute("id", "file_" + this.text);
          input.setAttribute("value", starter_code_bodies[i]);
          document.getElementById("file_contents").appendChild(input);
        });
      }

      initSetUpStarterFiles();

      // ace editor functions
      function textarea_edit(name) {
        var editor = ace.edit(name);
        editor.setTheme("ace/theme/chrome");
        editor.session.setMode("ace/mode/python");

        var textarea = $('textarea[name="' + name + '"]').hide();
        textarea.val(editor.getSession().getValue());
        editor.getSession().on('change', function(){
            textarea.val(editor.getSession().getValue());
            file_name_to_body[currently_selected_file] = editor.getSession().getValue();
            document.getElementById('file_' + currently_selected_file).value = editor.getSession().getValue();
        });
        return editor;
      }
      var code_editor = textarea_edit("editor");
      var test_case_editor = textarea_edit("test_case_editor");

      // populate all of the example code views
      var example_code_snippets = document.getElementsByClassName('example_code_view');
      for (var i = 0; i < example_code_snippets.length; ++i) {
          var example_code = example_code_snippets[i];  
          var editor = ace.edit(example_code.id);
          editor.setTheme("ace/theme/chrome");
          editor.session.setMode("ace/mode/python");
          editor.setReadOnly(true);
          editor.setOptions({
              maxLines: 15
          });
      }

      // on change select
      code_editor.setValue(file_name_to_body[currently_selected_file].toString(), -1);
      function onSelectFileChange() {
          currently_selected_file = $("#file-drop-down option:selected").text();
          code_editor.setValue(file_name_to_body[currently_selected_file].toString(), -1);        
      }

      
    
  </script>
  </body>
</html>
{% endblock %}